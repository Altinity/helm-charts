---
# Single-node deployment with TLS and load-balancer service
# Tests: Basic deployment with TLS using inline cert + secret refs, no keeper, minimal config
# Expected pods: 1 ClickHouse
clickhouse:
  replicasCount: 1
  shardsCount: 1
  
  defaultUser:
    password: "TestTLSPassword123"
    allowExternalAccess: true
  
  persistence:
    enabled: true
    size: 2Gi
    accessMode: ReadWriteOnce
  
  service:
    type: ClusterIP
  
  lbService:
    enabled: true
  
  extraPorts:
    - name: https
      containerPort: &httpsPort 8444
    - name: tcp-secure
      containerPort: &tcpSecurePort 9441
  
  tls:
    enabled: true
    httpsPort: *httpsPort
    secureTcpPort: *tcpSecurePort
    
    certificateFile:
      configFileName: foo.crt
      # To regenerate the public certificate:
      #   cd tests/fixtures/tls/    # this directory
      #   openssl req -x509 -key test-server.key -days 10950 \
      #     -out server.crt -config public-cert.cnf -extensions v3_req
      #
      # Update inlineFileContent with the new certificate content for
      # the public certificate to be used in the TLS test fixture.
      #
      # To verify the public certificate:
      #   openssl x509 -in server.crt -text -noout
      #
      # To verify that the private key & public certificate moduli match:
      #   openssl x509 -noout -modulus -in server.crt | openssl md5
      #   openssl rsa -noout -modulus -in test-server.key | openssl md5
      inlineFileContent: |
        -----BEGIN CERTIFICATE-----
        MIIDQjCCAiqgAwIBAgIUXWU1ixzpK9OTqFfA+ZhK/EOtLIYwDQYJKoZIhvcNAQEL
        BQAwHjEcMBoGA1UEAwwTKi5zdmMuY2x1c3Rlci5sb2NhbDAgFw0yNjAyMTQwMTIz
        NTNaGA8yMDU2MDIwNzAxMjM1M1owHjEcMBoGA1UEAwwTKi5zdmMuY2x1c3Rlci5s
        b2NhbDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAIvGupZ9FR3DLC1R
        /+7hbUySKYSIYOnfZQBnfkMVyLBDdp1WX9aspJLEaazO0rU4l0YjqnLsnckuBxmr
        OOzzeNA+8ExBkPEANR/mROMIcwXhrdFO3sWH2amVncHFUxspwgDhbZJ0zfVNtQo0
        Q/JthTWGqYW+4HbDnzOWWkUo23oZcClyELTbhQitxgrsOUyDIcR2ZNae3yueVAoK
        F12fH4Sms75FLvwwlUuWU3F1lJKr/U7nPxBdl6CY/sPXITov2LcmwlQLebCchjVB
        3kEvPKJRBPmW0Dyrr9IRyyExU3qfYdzsJdZOHY/qOB0Dw42qXolkf2L5m6GtW3EF
        hnqM5SsCAwEAAaN2MHQwCwYDVR0PBAQDAgWgMBMGA1UdJQQMMAoGCCsGAQUFBwMB
        MDEGA1UdEQQqMCiCFSouKi5zdmMuY2x1c3Rlci5sb2NhbIIJbG9jYWxob3N0hwR/
        AAABMB0GA1UdDgQWBBQzPiDb07CH5dKWb5xYa1PoGtz45jANBgkqhkiG9w0BAQsF
        AAOCAQEActxS3ySYtlVmykOlaqTaTj8wyZjQ+gFBQ9APEuKwT4+F2HcuIRWWxJIT
        Pt+CigSMG0XGFQi/+ZRfksXSmfcmErMgDUEr7jsxwvqn6esbAvHX02Vk82oAGkKu
        t3JVxRAz9Dsl1Hm0W+IAGO336QFwd7iTo367TKSz+jcyHRfnftEZnxtbIvqAkR7V
        8z1NRYhRR5ZeLpwjiqwdAU4AgXKQifQWeWjPeJJr+4pEvy2ivpzhhalX7/tB1TuP
        4hpQdRi/c+0h5pDtrBpW61gUb0xVWySIkMifLLXfLNjynLKBJmWG91M34fTK1O8+
        LYd+XhJEhXtFt8+3kktghDcehcuK7g==
        -----END CERTIFICATE-----
    
    privateKeyFile:
      configFileName: bar.key
      secretReference:
        name: clickhouse-certs
        key: server.key
    
    dhParamsFile:
      configFileName: dhparam.pem
      secretReference:
        name: clickhouse-certs
        key: dhparam.pem
    
    opensslConfig: |
      <clickhouse>
        <openSSL>
          <server>
            <certificateFile>/etc/clickhouse-server/config.d/foo.crt</certificateFile>
            <privateKeyFile>/etc/clickhouse-server/secrets.d/bar.key/clickhouse-certs/server.key</privateKeyFile>
            <dhParamsFile>/etc/clickhouse-server/secrets.d/dhparam.pem/clickhouse-certs/dhparam.pem</dhParamsFile>
            <verificationMode>relaxed</verificationMode>
            <loadDefaultCAFile>true</loadDefaultCAFile>
            <cacheSessions>true</cacheSessions>
            <disableProtocols>sslv2,sslv3</disableProtocols>
            <preferServerCiphers>true</preferServerCiphers>
          </server>
        </openSSL>
      </clickhouse>

keeper:
  enabled: false

operator:
  enabled: true


