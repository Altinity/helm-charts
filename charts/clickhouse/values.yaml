---
# @ignore
nameOverride: ""
# @ignore
fullnameOverride: ""

# -- Custom domain pattern used for DNS names of `Service` and `Pod` resources.
# Typically defined by the custom cluster domain of the Kubernetes cluster.
# The pattern follows the `%s` C-style printf format, e.g. '%s.svc.my.test'.
# If not specified, the default namespace domain suffix is `.svc.cluster.local`.
namespaceDomainPattern: ""

# Configure ClickHouse Installation and Pod Template
clickhouse:
  defaultUser:
    password: ""
    # -- Name of an existing Kubernetes secret containing the default user password.
    # If set, the password will be read from the secret instead of using the password field.
    # The secret should contain a key named 'password'.
    password_secret_name: ""
    # -- Allow the default user to access ClickHouse from any IP.
    # If set, will override `hostIP` to always be `0.0.0.0/0`.
    allowExternalAccess: false
    # defaultUser.hostIP -- (string) Set a mask for IPs allowed for the
    # default user. Should not be set if allowExternalAccess is set.
    # @default -- 127.0.0.1/32
    hostIP: 127.0.0.1/32

  # -- Configure additional ClickHouse users.
  users: []
  # users:
  #   - name: app_user
  #     hostIP: ["10.0.0.0/8"]  # default: "0.0.0.0/0"
  #     accessManagement: 1  # default: 0
  #     password_secret_name: "app-user-secret"  # secret must contain 'password' key
  #     grants:
  #       - "GRANT SELECT ON database.*"

  # -- number of replicas. If greater than 1, keeper must be enabled
  # or a keeper host should be provided under clickhouse.keeper.host.
  # Will be ignored if `zones` is set.
  replicasCount: 1

  # -- number of shards.
  shardsCount: 1

  # -- Cluster secret configuration for secure inter-node communication
  clusterSecret:
    # -- Whether to enable secret-based cluster communication
    enabled: false
    # -- Whether to secure this behind the SSL port
    secure: false
    # -- Auto-generate cluster secret (recommended for security)
    auto: true
    # -- Plaintext cluster secret value (not recommended for production)
    value: ""
    # -- Reference to an existing Kubernetes secret containing the cluster secret
    valueFrom:
      secretKeyRef:
        # -- Name of the secret containing the cluster secret
        name: ""
        # -- Key in the secret that contains the cluster secret value
        key: "secret"

  # Specify which zones to run in.
  # `replicaCount` will be applied within each zone.
  zones: []

  # If enabled, will prevent ClickHouse pods from running on the same node
  antiAffinity: false

  # -- Scope for anti-affinity policy when antiAffinity is enabled.
  # Determines the level at which pod distribution is enforced.
  # Available scopes:
  #   - ClickHouseInstallation: Pods from the same installation won't run on the same node (default)
  #   - Shard: Pods from the same shard won't run on the same node
  #   - Replica: Pods from the same replica won't run on the same node
  #   - Cluster: Pods from the same cluster won't run on the same node
  #   - Namespace: Pods from the same namespace won't run on the same node
  # @default -- ClickHouseInstallation
  antiAffinityScope: "ClickHouseInstallation"

  # -- Keeper connection settings for ClickHouse instances.
  keeper:
    # -- Specify a keeper host.
    # Should be left empty if `clickhouse-keeper.enabled` is `true`.
    # Will override the defaults set from `clickhouse-keeper.enabled`.
    host: ""
    # -- Override the default keeper port
    port: 2181

  persistence:
    # -- enable storage
    enabled: true
    # -- volume size (per replica)
    size: 10Gi
    accessMode: ReadWriteOnce
    ## -- StorageClass for PV (e.g. gp2, standard, ...)
    storageClass: ""
    logs:
      # -- enable pvc for logs
      enabled: false
      # -- size for logs pvc
      size: 10Gi
      accessMode: ReadWriteOnce

  image:
    repository: altinity/clickhouse-server
    pullPolicy: IfNotPresent
    # -- Override the image tag for a specific version
    tag: "25.3.6.10034.altinitystable"

  service:
    # e.g. `LoadBalancer`, `NodePort`
    type: ClusterIP
    serviceAnnotations: {}
    serviceLabels: {}

  lbService:
    enabled: false
    # -- Specify source IP ranges to the LoadBalancer service.
    # If supported by the platform, this will restrict traffic through the cloud-provider load-balancer
    # to the specified client IPs. This is ignored if the cloud-provider does not support the feature.
    loadBalancerSourceRanges: []
    serviceAnnotations: {}
    serviceLabels: {}

  # @ignore
  imagePullSecrets: []

  serviceAccount:
    # -- Specifies whether a service account should be created
    create: false
    # -- Annotations to add to the service account
    annotations: {}
    # -- The name of the service account to use.
    # If not set and create is true, a name is generated using the fullname template
    name: ""

  podAnnotations: {}
  podLabels: {}

  # @ignore
  podSecurityContext: {}
    # runAsUser: 101
    # runAsGroup: 101

  # @ignore
  securityContext: {}

  # @ignore
  nodeSelector: {}

  # @ignore
  tolerations: []

  # @ignore
  affinity: {}

  # @ignore
  topologySpreadConstraints: []


  # -- Additional ports to expose in the ClickHouse container
  # Example:
  # extraPorts:
  #   - name: custom-port
  #     containerPort: 8080
  extraPorts: []

  # -- Miscellanous config for ClickHouse (in xml format)
  extraConfig: |
    <clickhouse>
    </clickhouse>
  # -- Additional users config for ClickHouse (in xml format)
  extraUsers: |
    <clickhouse>
    </clickhouse>

  # -- Extra containers for clickhouse pods
  extraContainers: []

  # -- Extra volumes for clickhouse pods
  extraVolumes: []

  # -- Init scripts ConfigMap configuration
  initScripts:
    # -- Set to true to enable init scripts feature
    enabled: false
    # -- Name of an existing ConfigMap containing init scripts
    # The scripts will be mounted at /docker-entrypoint-initdb.d/
    configMapName: ""
    # -- Set to true to always run init scripts on container startup
    alwaysRun: true

# CHK parameters
keeper:
  # -- Whether to enable Keeper.
  # Required for replicated tables.
  enabled: false
  # -- Number of keeper replicas.
  # Must be an odd number.
  # !! DO NOT CHANGE AFTER INITIAL DEPLOYMENT
  replicaCount: 3
  image: "altinity/clickhouse-keeper"
  tag: "25.3.6.10034.altinitystable"
  # allows to configure multiple aspects and behavior for `clickhouse-keeper`
  # instance
  settings: {}
  localStorage:
    size: 5Gi
    storageClass: ""
  nodeSelector: {}
  tolerations: []
  podAnnotations: {}
  volumeClaimAnnotations: {}
  # topologySpreadConstraints over `zone`, by deafult there is only
  # podAntiAffinity by hostname
  zoneSpread: false
  metricsPort: ""
  resources:
    cpuRequestsMs: 2
    memoryRequestsMiB: 3Gi
    cpuLimitsMs: 3
    memoryLimitsMiB: 3Gi

operator:
  # -- Whether to enable the Altinity Operator for ClickHouse.
  # Disable if you already have the Operator installed cluster-wide.
  enabled: true
  
